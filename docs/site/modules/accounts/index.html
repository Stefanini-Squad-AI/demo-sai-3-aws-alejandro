<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACCOUNT - Gu√≠a Operacional para Historias de Usuario</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f7fa;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 3rem 2rem;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .header a {
            color: #ffe082;
            text-decoration: underline;
            font-weight: 600;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .section {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
            margin-bottom: 2rem;
        }

        .section h2 {
            color: #667eea;
            margin-bottom: 1rem;
            font-size: 1.8rem;
        }

        .section h3 {
            color: #444;
            margin-bottom: 0.75rem;
            margin-top: 1rem;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.25rem;
            margin-top: 1rem;
        }

        .card {
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            padding: 1.5rem;
            background: #f8f9fa;
            min-height: 180px;
        }

        .card h4 {
            color: #1f3c88;
            margin-bottom: 0.5rem;
        }

        .section ul {
            margin-top: 1rem;
            list-style: none;
            padding-left: 1rem;
        }

        .section ul li {
            position: relative;
            padding-left: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .section ul li:before {
            content: "‚Ä¢";
            position: absolute;
            left: 0;
            color: #667eea;
            font-weight: 700;
        }

        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 1rem;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 0.9rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        th, td {
            padding: 0.75rem;
            border-bottom: 1px solid #ddd;
            text-align: left;
        }

        th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }

        .rule {
            background: #e3f2fd;
            padding: 1rem 1.25rem;
            border-left: 4px solid #2196f3;
            border-radius: 6px;
            margin-bottom: 1rem;
        }

        footer {
            text-align: center;
            padding: 2rem;
            color: #666;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
        }

        footer a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }

        footer a:hover {
            text-decoration: underline;
        }

        .complexity {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            background: #f1f5f9;
            border: 1px solid #cbd5f5;
            font-size: 0.9rem;
            margin-right: 0.5rem;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <h1>üí≥ ACCOUNT - Gu√≠a Operacional</h1>
        <p>Consulta y edici√≥n de cuentas de tarjetas con validaciones, m√°scara de datos sensibles y hooks compartidos para timeline y actualizaciones.</p>
        <p style="margin-top: 0.75rem;">
            <strong>Documentaci√≥n extendida:</strong>
            <a href="../../../modules/account/account-overview.md">docs/modules/account/account-overview.md</a>
        </p>
    </header>

    <div class="container">
        <section class="section">
            <h2>üìã Visi√≥n general del m√≥dulo</h2>
            <p>
                El m√≥dulo ACCOUNT combina <strong>AccountViewScreen</strong> y <strong>AccountUpdateScreen</strong> para dar soporte a consultas, m√°scara de datos financieros, edici√≥n controlada y confirmaci√≥n transaccional. Ambos componentes usan <strong>SystemHeader</strong>, el hook de API compartido y Material UI para conservar consistencia con otras pantallas del producto.
            </p>
            <ul style="line-height: 2;">
                <li>Validaci√≥n estricta en frontend/back: solo IDs de 11 d√≠gitos y no ceros (¬º conductas replicadas en <code>accountHandlers</code> y <code>accountUpdateHandlers</code>).</li>
                <li>Soporte r√°pido: `useAccountView` carga metadata con `/account-view/initialize` y `useAccountUpdate` detecta cambios con `JSON.stringify`.</li>
                <li>Seguridad: SSN y n√∫mero de tarjeta se enmascaran hasta que el usuario presiona ‚ÄúShow Sensitive Data‚Äù.</li>
            </ul>
            <div class="grid">
                <div class="card">
                    <h4>Cuentas de prueba</h4>
                    <p>11111111111 (Premium), 22222222222 (Inactive), 33333333333 (Platinum), 44444444444 (New Basic). El bot√≥n ‚ÄúShow Test Accounts‚Äù despliega el array definido en <code>AccountViewScreen</code> para acelerar QA.</p>
                </div>
                <div class="card">
                    <h4>Atajos de teclado</h4>
                    <p>ENTER ejecuta Search, F3/Escape cierra la pantalla, F5 guarda (cuando hay cambios) y F12 resetea el formulario. Cada manejador se encuentra en <code>AccountViewScreen</code> y <code>AccountUpdateScreen</code>.</p>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>üéØ Gu√≠a de User Stories</h2>
            <div class="grid">
                <div class="card">
                    <h4>Consulta guiada</h4>
                    <p><strong>Como representante de servicio</strong>, quiero ingresar un Account ID de 11 d√≠gitos para mostrar saldo, l√≠mites, estado y tarjetas asociadas y responder dudas del titular.</p>
                </div>
                <div class="card">
                    <h4>Actualizaci√≥n segura</h4>
                    <p><strong>Como administrador</strong>, quiero editar cr√©dito, ZIP y FICO con validaciones en l√≠nea, confirmar los cambios y recibir retroalimentaci√≥n del backend.</p>
                </div>
                <div class="card">
                    <h4>Protecci√≥n de datos</h4>
                    <p><strong>Como oficial de cumplimiento</strong>, quiero que el SSN y el n√∫mero de tarjeta est√©n ocultos por defecto y solo se muestren despu√©s de pulsar ‚ÄúShow Sensitive Data‚Äù.</p>
                </div>
            </div>
            <div class="complexity">Simple (1-2 pts): b√∫squeda + visualizaci√≥n</div>
            <div class="complexity">Medio (3-5 pts): validaciones de edici√≥n</div>
            <div class="complexity">Complejo (5-8 pts): integraci√≥n de auditor√≠a</div>
        </section>

        <section class="section">
            <h2>‚ö° Factores de aceleraci√≥n</h2>
            <ul style="line-height: 2;">
                <li><strong>useAccountView / useAccountUpdate:</strong> encapsulan estados, errores, callbacks y resets usando <code>useMutation</code>.</li>
                <li><strong>SystemHeader + LoadingSpinner:</strong> est√°n listos para replicar el banner transaccional y los estados de carga.</li>
                <li><strong>apiClient + HttpClient:</strong> manejo uniforme de headers (Content-Type + Authorization), timeouts 10‚ÄØs y detecci√≥n de estructuras MSW/back.</li>
                <li><strong>MSW handlers:</strong> simulan errores de validaci√≥n y un caso cr√≠tico 500 para probar retroalimentaci√≥n.</li>
                <li><strong>Material UI:</strong> Cards, Grid, Chip, Switch, Dialog, Snackbar y TextField con adornos aceleran la UI.</li>
            </ul>
        </section>

        <section class="section">
            <h2>üîß Fundamento t√©cnico</h2>
            <div class="grid">
                <div class="card">
                    <h4>AccountViewScreen.tsx</h4>
                    <p>Formulario con validaci√≥n, bot√≥n de cuentas de prueba, toggle ‚ÄúShow Sensitive Data‚Äù, tarjetas financieras en Grid y Alert para errores/infos.</p>
                    <p><strong>Ubicaci√≥n:</strong> <code>/app/components/account/AccountViewScreen.tsx</code></p>
                </div>
                <div class="card">
                    <h4>AccountUpdateScreen.tsx</h4>
                    <p>Modo edici√≥n controlado, Switch ‚ÄúEdit Mode‚Äù, Chips de estado, validaciones locales, confirmaci√≥n con Dialog y atajos F3/F5/F12.</p>
                    <p><strong>Ubicaci√≥n:</strong> <code>/app/components/account/AccountUpdateScreen.tsx</code></p>
                </div>
                <div class="card">
                    <h4>useAccountView.ts</h4>
                    <p>Busca con GET `/account-view?accountId=...`, inicializa metadata y expone <code>clearData</code> para reset al salir.</p>
                    <p><strong>Hooks:</strong> <code>searchAccount</code>, <code>initializeScreen</code>, <code>clearData</code>.</p>
                </div>
                <div class="card">
                    <h4>useAccountUpdate.ts</h4>
                    <p>GET `/accounts/{id}` + PUT (`AccountUpdateResponse`), detecta cambios con <code>originalData</code> y proporciona <code>hasChanges</code>.</p>
                    <p><strong>Hooks:</strong> <code>updateLocalData</code>, <code>resetForm</code>, <code>clearData</code>.</p>
                </div>
                <div class="card">
                    <h4>apiClient / HttpClient</h4>
                    <p>Base URL configurable con <code>VITE_API_BASE_URL</code>, 10‚ÄØs timeout, headers JSON + Authorization y logs del response.</p>
                </div>
                <div class="card">
                    <h4>useMutation / useApi</h4>
                    <p>Maneja AbortController, detecta respuestas MSW/back con <code>success/data</code> o <code>currentDate</code>, y propaga errores al UI.</p>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>üåê Interfaces p√∫blicas</h2>
            <pre><code>GET  /api/account-view?accountId={id}      ‚Üí Devuelve AccountViewResponse (info financiera, SSN enmascarado, mensajes)
GET  /api/account-view/initialize            ‚Üí Metadata inicial (dates, transactionId, infoMessage)
GET  /api/accounts/{accountId}               ‚Üí AccountUpdateData para formularios
PUT  /api/accounts/{accountId}               ‚Üí Recibe AccountUpdateData, valida ZIP/FICO/activeStatus y devuelve AccountUpdateResponse</code></pre>
            <p>Nota: MSW tambi√©n simula <code>PUT /api/accounts/99999999999</code> con error 500 para verificar mensaje de ‚ÄúDatabase connection timeout‚Äù.</p>
        </section>

        <section class="section">
            <h2>üìä Modelos y validaciones clave</h2>
            <table>
                <thead>
                    <tr>
                        <th>Campo</th>
                        <th>Descripci√≥n</th>
                        <th>Regla</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>accountId</td><td>ID de cuenta (frontend string)</td><td>11 d√≠gitos, no todo ceros</td></tr>
                    <tr><td>activeStatus</td><td>Status del ciclo</td><td>Solo 'Y' o 'N' (dropdown)</td></tr>
                    <tr><td>creditLimit / cashCreditLimit</td><td>Montos financieros</td><td>Valores num√©ricos ‚â• 0</td></tr>
                    <tr><td>ficoScore</td><td>Score crediticio</td><td>Entre 300 y 850</td></tr>
                    <tr><td>zipCode</td><td>C√≥digo postal</td><td>Regex <code>^\d{5}(-\d{4})?$</code></td></tr>
                    <tr><td>customerSsn / cardNumber</td><td>Data sensible</td><td>Masking por defecto, toggle permitir mostrar</td></tr>
                </tbody>
            </table>
        </section>

        <section class="section">
            <h2>üìã Reglas de negocio confirmadas</h2>
            <div class="rule">
                <strong>RN-011:</strong> Account ID debe ser num√©rico, 11 d√≠gitos y distinto de 00000000000; la UI muestra error y MSW efect√∫a validaci√≥n id√©ntica.
            </div>
            <div class="rule">
                <strong>RN-012:</strong> Status solo acepta 'Y' o 'N' y se representa con <code>Chip</code> verde/rojo en ambas pantallas.
            </div>
            <div class="rule">
                <strong>RN-013:</strong> Si el backend responde con <code>infoMessage</code> o <code>errorMessage</code>, se muestra un <code>Alert</code> correspondiente.
            </div>
            <div class="rule">
                <strong>RN-014:</strong> Actualizaci√≥n de cuenta/cliente es at√≥mica; la UI despliega un di√°logo de confirmaci√≥n y se resetea el modo de edici√≥n tras el guardado.
            </div>
        </section>

        <section class="section">
            <h2>‚úÖ Patrones de criterios de aceptaci√≥n</h2>
            <div class="grid">
                <div class="card">
                    <h4>Busqueda exitosa</h4>
                    <p><strong>Dado</strong> el ID 11111111111<br><strong>Cuando</strong> presiono Search<br><strong>Entonces</strong> recibo tarjetas con balance, grupo y estado activo.</p>
                </div>
                <div class="card">
                    <h4>Actualizaci√≥n segura</h4>
                    <p><strong>Dado</strong> editMode activo<br><strong>Cuando</strong> cambio ZIP y presiono Save<br><strong>Entonces</strong> aparece di√°logo de confirmaci√≥n y se ejecuta PUT.</p>
                </div>
                <div class="card">
                    <h4>Validaci√≥n</h4>
                    <p><strong>Dado</strong> ingreso un ZIP inv√°lido<br><strong>Cuando</strong> intento guardar<br><strong>Entonces</strong> aparece helper text y el bot√≥n Save se desactiva hasta corregir.</p>
                </div>
                <div class="card">
                    <h4>Error del backend</h4>
                    <p><strong>Dado</strong> accountId 99999999999<br><strong>Cuando</strong> guardo cambios<br><strong>Entonces</strong> MSW responde 500 y el Alert muestra ‚ÄúDatabase connection timeout‚Äù.</p>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>‚ö° Presupuestos de performance</h2>
            <ul style="line-height: 2;">
                <li>Derivado de MSW: Search se simula en ~800‚ÄØms y Update en ~1.2‚ÄØs, pero el objetivo de producci√≥n es <500‚ÄØms / <800‚ÄØms.</li>
                <li><strong>HttpClient</strong> cancela peticiones despu√©s de 10‚ÄØs y evita duplicados con AbortController.</li>
                <li>Los hooks abortan llamadas previas para mantener consistencia cuando el usuario teclea r√°pido.</li>
            </ul>
        </section>

        <section class="section">
            <h2>üß™ Pruebas & mocks</h2>
            <div class="grid">
                <div class="card">
                    <h4>accountHandlers</h4>
                    <p>Simula GET /api/account-view, /account-view/initialize y /account-view/process con validaciones, mensajes y delays.</p>
                    <p>Expone las respuestas con <code>success: true</code> para que <code>useMutation</code> las maneje sin perder la estructura.</p>
                </div>
                <div class="card">
                    <h4>accountUpdateHandlers</h4>
                    <p>Maneja GET/PUT /api/accounts/{id}, valida ZIP/FICO/activeStatus y fuerza un error 500 en 99999999999 para verificaciones de resiliencia.</p>
                    <p>Se usa para probar <code>Alert</code>, <code>Dialog</code> y la reactividad de <code>hasChanges</code>.</p>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>üö® Riesgos & mitigaciones</h2>
            <div class="grid">
                <div class="card">
                    <h4>Dependencia de mocks</h4>
                    <p>Sin backend real, las validaciones se basan en MSW. Recomendado validar las rutas y contratos cuando se habilite la API real.</p>
                </div>
                <div class="card">
                    <h4>Datos sensibles en memoria</h4>
                    <p>El toggle <em>Show Sensitive Data</em> expone SSN/card numbers. El hook <code>clearData</code> se llama al desmontar para limpiar el estado.</p>
                </div>
                <div class="card">
                    <h4>Falta de auditor√≠a</h4>
                    <p>No existe trazabilidad autom√°tica de qui√©n presiona Save. Futuro: agregar Audit Trail en backend y mostrar hist√≥rico.</p>
                </div>
                <div class="card">
                    <h4>Actualizaciones concurrentes</h4>
                    <p>Dos usuarios podr√≠an sobrescribir datos sin control de versiones. Mitigaci√≥n: expandir backend con ETags o comparaci√≥n de timestamp.</p>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>üìö Documentaci√≥n complementaria</h2>
            <p>Consulta la documentaci√≥n extendida en <a href="../../../modules/account/account-overview.md">docs/modules/account/account-overview.md</a> y revisa la visi√≥n global en <a href="../../../system-overview.md#-account---gesti√≥n-de-cuentas">system-overview.md</a>.</p>
        </section>
    </div>

    <footer>
        <p><a href="../../index.html">‚Üê Volver al √≠ndice principal</a></p>
        <p><a href="../../../system-overview.md">üè† Volver al System Overview</a></p>
        <p><a href="../../../modules/account/account-overview.md">üìò Leer account-overview.md</a></p>
    </footer>
</body>
</html>
